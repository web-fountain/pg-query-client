/* AIDEV-NOTE: PanelLayout styles â€“ ordered for readability; no functional changes
   Sections:
   1) Pre-hydration and root fallbacks
   2) Base container
   3) Swapped layout
   4) Dragging (transition disable)
   5) Slots and handles
   6) Collapsed states (explicit)
   7) Optional visuals
   8) Container queries
*/

/* 1) Pre-hydration and root fallbacks */
:root[data-op-space-left-collapsed] .panel-layout:not([data-left-collapsed]) .left-side { visibility: hidden; }
:root[data-op-space-right-collapsed] .panel-layout:not([data-right-collapsed]) .right-side { visibility: hidden; }
:root[data-op-space-pre-hydration][data-op-space-left-collapsed] .panel-layout:not([data-left-collapsed]),
:root[data-op-space-pre-hydration][data-op-space-right-collapsed] .panel-layout:not([data-right-collapsed]) { transition: none; }

/* Left collapsed (fallback widths) */
:root[data-op-space-left-collapsed] .panel-layout:not([data-left-collapsed]) {
  grid-template-columns:
    var(--op-space-layout-panel-collapsed-width)
    var(--op-space-layout-resizer-width)
    minmax(var(--calculated-center-min-width), 1fr)
    var(--op-space-layout-resizer-width)
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-right-panel-width),
      var(--calculated-panel-max-width)
    );
}
:root[data-op-space-left-collapsed] .panel-layout[data-content-swapped]:not([data-left-collapsed]) {
  grid-template-columns:
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-right-panel-width),
      var(--calculated-panel-max-width)
    )
    var(--op-space-layout-resizer-width)
    minmax(var(--calculated-center-min-width), 1fr)
    var(--op-space-layout-resizer-width)
    var(--op-space-layout-panel-collapsed-width);
}

/* Right collapsed (fallback widths) */
:root[data-op-space-right-collapsed] .panel-layout[data-content-swapped]:not([data-right-collapsed]) {
  grid-template-columns:
    var(--op-space-layout-panel-collapsed-width)
    var(--op-space-layout-resizer-width)
    minmax(var(--calculated-center-min-width), 1fr)
    var(--op-space-layout-resizer-width)
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-left-panel-width),
      var(--calculated-panel-max-width)
    );
}
:root[data-op-space-right-collapsed] .panel-layout:not([data-right-collapsed]) {
  grid-template-columns:
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-left-panel-width),
      var(--calculated-panel-max-width)
    )
    var(--op-space-layout-resizer-width)
    minmax(var(--calculated-center-min-width), 1fr)
    var(--op-space-layout-resizer-width)
    var(--op-space-layout-panel-collapsed-width);
}

/* Both-sides collapsed (pre-hydration) */
:root[data-op-space-left-collapsed][data-op-space-right-collapsed]
.panel-layout:not([data-left-collapsed]):not([data-right-collapsed]) {
  grid-template-columns:
    var(--op-space-layout-panel-collapsed-width)
    0
    minmax(0, 1fr)
    0
    var(--op-space-layout-panel-collapsed-width);
}

/* Mixed-state guards: ensure explicit collapsed side wins during transient root fallback mismatches */
/* Root says RIGHT collapsed, container has LEFT collapsed (and not right): keep LEFT collapsed */
:root[data-op-space-right-collapsed] .panel-layout[data-left-collapsed]:not([data-right-collapsed]) {
  grid-template-columns:
    var(--op-space-layout-panel-collapsed-width)
    0
    minmax(var(--calculated-center-min-width), 1fr)
    0
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-right-panel-width),
      var(--calculated-panel-max-width)
    );
}
:root[data-op-space-right-collapsed] .panel-layout[data-content-swapped][data-left-collapsed]:not([data-right-collapsed]) {
  grid-template-columns:
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-right-panel-width),
      var(--calculated-panel-max-width)
    )
    0
    minmax(var(--calculated-center-min-width), 1fr)
    0
    var(--op-space-layout-panel-collapsed-width);
}

/* Root says LEFT collapsed, container has RIGHT collapsed (and not left): keep RIGHT collapsed */
:root[data-op-space-left-collapsed] .panel-layout[data-right-collapsed]:not([data-left-collapsed]) {
  grid-template-columns:
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-left-panel-width),
      var(--calculated-panel-max-width)
    )
    0
    minmax(var(--calculated-center-min-width), 1fr)
    0
    var(--op-space-layout-panel-collapsed-width);
}
:root[data-op-space-left-collapsed] .panel-layout[data-content-swapped][data-right-collapsed]:not([data-left-collapsed]) {
  grid-template-columns:
    var(--op-space-layout-panel-collapsed-width)
    0
    minmax(var(--calculated-center-min-width), 1fr)
    0
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-left-panel-width),
      var(--calculated-panel-max-width)
    );
}

/* 2) Base container */
.panel-layout {
  /* AIDEV-NOTE: panels do not scroll; inner content containers should; grid area controls layout */
  /* AIDEV-NOTE: Width custom properties are controlled on :root by the provider; do NOT set here or updates won't propagate */
  --op-space-layout-gap:                   var(--space-4);
  --op-space-layout-panel-collapsed-width: 48px;

  /* AIDEV-NOTE: Screen-aware layout calculations using screen dimension variables */
  --calculated-panel-max-width: min(
    var(--op-space-layout-panel-max-width),
    calc(var(--screen-width) * 1px * 0.35)
  );
  --calculated-center-min-width: max(
    var(--op-space-layout-panel-min-width),
    calc(var(--screen-width) * 1px * 0.3)
  );

  /* AIDEV-NOTE: Enable container queries for component-scoped responsiveness */
  container-type: inline-size;
  container-name: panel-layout;

  display: grid;
  grid-template-columns:
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-left-panel-width),
      var(--calculated-panel-max-width)
    )
    0
    minmax(var(--calculated-center-min-width), 1fr)
    0
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-right-panel-width),
      var(--calculated-panel-max-width)
    );
  grid-template-areas: 'left handle-left center handle-right right';
  height: calc(var(--available-height));
  min-height: 0;
  grid-template-rows: 1fr;
  gap: 0;
  background: var(--surface-1);
  color: var(--text-primary);
  transition: grid-template-columns var(--duration-250) var(--ease-standard);
}

/* 3) Swapped layout */
.panel-layout[data-content-swapped],
:root[data-op-space-content-swapped] .panel-layout:not([data-content-swapped]) {
  grid-template-columns:
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-right-panel-width),
      var(--calculated-panel-max-width)
    )
    0
    minmax(var(--calculated-center-min-width), 1fr)
    0
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-left-panel-width),
      var(--calculated-panel-max-width)
    );
  grid-template-areas: 'right handle-right center handle-left left';
}

/* 4) Dragging (transition disable) */
:root[data-op-space-layout-dragging] .panel-layout { transition: none; }

/* 5) Slots and handles */
.panel-layout .left-side,
.panel-layout .center,
.panel-layout .right-side {
  min-width: 0;
  overflow: hidden;
  height: 100%;
}
.panel-layout .left-side  { grid-area: left; }
.panel-layout .center     { grid-area: center; display: flex; flex-direction: column; min-height: 0; }
.panel-layout .right-side { grid-area: right; }
.panel-layout .handle-left,
.panel-layout .handle-right { inline-size: 0; block-size: 100%; cursor: col-resize; }
.panel-layout .handle-left  { grid-area: handle-left; }
.panel-layout .handle-right { grid-area: handle-right; }

/* 6) Collapsed states (explicit) */
.panel-layout[data-left-collapsed] {
  grid-template-columns:
    var(--op-space-layout-panel-collapsed-width)
    0
    minmax(var(--calculated-center-min-width), 1fr)
    0
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-right-panel-width),
      var(--calculated-panel-max-width)
    );
}
.panel-layout[data-content-swapped][data-left-collapsed] {
  grid-template-columns:
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-right-panel-width),
      var(--calculated-panel-max-width)
    )
    0
    minmax(var(--calculated-center-min-width), 1fr)
    0
    var(--op-space-layout-panel-collapsed-width);
}
.panel-layout[data-right-collapsed] {
  grid-template-columns:
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-left-panel-width),
      var(--calculated-panel-max-width)
    )
    0
    minmax(var(--calculated-center-min-width), 1fr)
    0
    var(--op-space-layout-panel-collapsed-width);
}
.panel-layout[data-content-swapped][data-right-collapsed] {
  grid-template-columns:
    var(--op-space-layout-panel-collapsed-width)
    0
    minmax(var(--calculated-center-min-width), 1fr)
    0
    clamp(
      var(--op-space-layout-panel-min-width),
      var(--op-space-layout-left-panel-width),
      var(--calculated-panel-max-width)
    );
}

/* When both sides are collapsed, keep both handles visible */
.panel-layout[data-left-collapsed][data-right-collapsed] {
  grid-template-columns:
    var(--op-space-layout-panel-collapsed-width)
    0
    minmax(0, 1fr)
    0
    var(--op-space-layout-panel-collapsed-width);
}

/* 7) Optional visuals */
.panel-layout .left-side  { border-inline-end:  var(--border-1) solid var(--border-color); background: var(--surface-1); }
.panel-layout .right-side { border-inline-start: var(--border-1) solid var(--border-color); background: var(--surface-1); }
.panel-layout[data-content-swapped] .left-side  { border-inline-end: 0; border-inline-start: var(--border-1) solid var(--border-color); }
.panel-layout[data-content-swapped] .right-side { border-inline-start: 0; border-inline-end:   var(--border-1) solid var(--border-color); }
.panel-layout .center { background: var(--surface-canvas); }

/* 8) Container queries */
@container panel-layout (max-width: 768px) {
  .panel-layout {
    --calculated-panel-max-width: calc(100cqi - 100px);
    --calculated-center-min-width: 200px;
    grid-template-columns: 1fr !important;
    grid-template-areas: 'center' !important;
  }
  .panel-layout .left-side,
  .panel-layout .right-side,
  .panel-layout .handle-left,
  .panel-layout .handle-right { display: none; }
}

@container panel-layout (min-width: 1920px) {
  .panel-layout { --calculated-panel-max-width: min(800px, 40cqi); }
}
